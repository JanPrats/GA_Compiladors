#include <string.h>
#include "module_automata.h"

AutomataDFA identifier_automata = {
    .alphabet = {
        // Minúsculas (1)   [a-z]
        {'a', 1}, {'b', 1}, {'c', 1}, {'d', 1}, {'e', 1}, {'f', 1}, {'g', 1}, {'h', 1}, {'i', 1},
        {'j', 1}, {'k', 1}, {'l', 1}, {'m', 1}, {'n', 1}, {'o', 1}, {'p', 1}, {'q', 1},
        {'r', 1}, {'s', 1}, {'t', 1}, {'u', 1}, {'v', 1}, {'w', 1}, {'x', 1}, {'y', 1}, {'z', 1},
        
        // Mayúsculas (1)   [A-Z]
        {'A', 1}, {'B', 1}, {'C', 1}, {'D', 1}, {'E', 1}, {'F', 1}, {'G', 1}, {'H', 1}, {'I', 1},
        {'J', 1}, {'K', 1}, {'L', 1}, {'M', 1}, {'N', 1},  {'O', 1}, {'P', 1}, {'Q', 1},
        {'R', 1}, {'S', 1}, {'T', 1}, {'U', 1}, {'V', 1}, {'W', 1}, {'X', 1}, {'Y', 1}, {'Z', 1},
        
        // Dígitos (2)      [0-9]
        {'0', 2}, {'1', 2}, {'2', 2}, {'3', 2}, {'4', 2}, {'5', 2}, {'6', 2}, {'7', 2}, {'8', 2}, {'9', 2},
        
        // Otros caracteres (0)
        {' ', 0}, {'\t', 0}, {'\n', 0}, {'\r', 0},
        {'.', 0}, {',', 0}, {';', 0}, {':', 0},
        {'!', 0},  {'?', 0},
        {'"', 0}, {'\'', 0}, {'`', 0},
        {'(', 0}, {')', 0}, {'[', 0}, {']', 0}, {'{', 0}, {'}', 0},
        {'+', 0}, {'-', 0}, {'*', 0}, {'/', 0}, {'%', 0},
        {'=', 0}, {'<', 0}, {'>', 0},
        {'&', 0}, {'|', 0}, {'^', 0}, {'~', 0},
        {'@', 0}, {'#', 0}, {'$', 0}, {'_', 0},
        {'\\', 0}
    },
    .states = { 0, 1, 2 },
    .start_state = 1,
    .current_state = 1,
    .accepting_states = { 2 },
    .matrix = {
        .states_rows = {//  [Other Characters] [a-zA-Z] [0-9]
            { .new_state = { 0, 0, 0 } }, // [Ø state] (NULL state)
            { .new_state = { 0, 2, 0 } }, // [start state]
            { .new_state = { 0, 2, 2 } }  // [accepting state]
        },
        .width = 3,   
        .height = 3,   
    },
    .type = CAT_IDENTIFIER,
    .dont_look_anymore = false
};

AutomataDFA literal_automata = {
    .alphabet = {
        // Quote (1)
        {'"', 1},

        // Altres caràcters de l’alfabet (0)
        {'a', 0}, {'b', 0}, {'c', 0}, {'d', 0}, {'e', 0},
        {'f', 0}, {'g', 0}, {'h', 0}, {'i', 0}, {'j', 0},
        {'k', 0}, {'l', 0}, {'m', 0}, {'n', 0},
        {'o', 0}, {'p', 0}, {'q', 0}, {'r', 0}, {'s', 0},
        {'t', 0}, {'u', 0}, {'v', 0}, {'w', 0}, {'x', 0},
        {'y', 0}, {'z', 0},

        {'A', 0}, {'B', 0}, {'C', 0}, {'D', 0}, {'E', 0},
        {'F', 0}, {'G', 0}, {'H', 0}, {'I', 0}, {'J', 0},
        {'K', 0}, {'L', 0}, {'M', 0}, {'N', 0}, 
        {'O', 0}, {'P', 0}, {'Q', 0}, {'R', 0}, {'S', 0},
        {'T', 0}, {'U', 0}, {'V', 0}, {'W', 0}, {'X', 0},
        {'Y', 0}, {'Z', 0},

        {'0', 0}, {'1', 0}, {'2', 0}, {'3', 0}, {'4', 0},
        {'5', 0}, {'6', 0}, {'7', 0}, {'8', 0}, {'9', 0},

        {' ', 0}, {'\t', 0}, {'\n', 0}, {'\r', 0},
        {';', 0}, {',', 0}, {'(', 0}, {')', 0},
        {'{', 0}, {'}', 0}, {'[', 0}, {']', 0},
        {'+', 0}, {'-', 0}, {'*', 0}, {'/', 0},
        {'=', 0}, {'<', 0}, {'>', 0},
        {'&', 0}, {'|', 0}, {'^', 0}, {'~', 0},
        {'@', 0}, {'#', 0}, {'$', 0}, {'_', 0},
        {'\\', 0}, {'\'', 0}, {'`', 0},
        {'!', 0},  {'?', 0}, 
        {'.', 0}, {':', 0}, {'%', 0}
    },

    .states = { 0, 1, 2, 3 },

    .start_state = 1,
    .current_state = 1,

    .accepting_states = { 3 },

    .matrix = {
        .states_rows = {
            // [Other] [Quote]
            { .new_state = {0,0} },  // 0 (mort)
            { .new_state = {0,2} },  // 1 (start)
            { .new_state = {2,3} },  // 2 (inside literal)
            { .new_state = {0,0} }   // 3 (accept)
        },

        .width = 2,
        .height = 4,
    },

    .type = CAT_LITERAL,
    .dont_look_anymore = false
};

AutomataDFA operator_automata = {
    .alphabet = {
        // Operadores válidos (1)
        {'+', 1}, {'=', 1}, {'*', 1}, {'>', 1},

        // Otros caracteres (0)
        {'a', 0}, {'b', 0}, {'c', 0}, {'d', 0}, {'e', 0}, {'f', 0},
        {'g', 0}, {'h', 0}, {'i', 0}, {'j', 0}, {'k', 0}, {'l', 0},
        {'m', 0}, {'n', 0}, {'o', 0}, {'p', 0}, {'q', 0},
        {'r', 0}, {'s', 0}, {'t', 0}, {'u', 0}, {'v', 0}, {'w', 0},
        {'x', 0}, {'y', 0}, {'z', 0},

        {'A', 0}, {'B', 0}, {'C', 0}, {'D', 0}, {'E', 0}, {'F', 0},
        {'G', 0}, {'H', 0}, {'I', 0}, {'J', 0}, {'K', 0}, {'L', 0},
        {'M', 0}, {'N', 0}, {'O', 0}, {'P', 0}, {'Q', 0},
        {'R', 0}, {'S', 0}, {'T', 0}, {'U', 0}, {'V', 0}, {'W', 0},
        {'X', 0}, {'Y', 0}, {'Z', 0},

        {'0', 0}, {'1', 0}, {'2', 0}, {'3', 0}, {'4', 0},
        {'5', 0}, {'6', 0}, {'7', 0}, {'8', 0}, {'9', 0},

        {' ', 0}, {'\t', 0}, {'\n', 0}, {'\r', 0},
        {'.', 0}, {',', 0}, {';', 0}, {':', 0},
        {'!', 0},  {'?', 0}, 
        {'"', 0}, {'\'', 0}, {'`', 0},
        {'(', 0}, {')', 0}, {'[', 0}, {']', 0}, {'{', 0}, {'}', 0},
        {'-', 0}, {'/', 0}, {'%', 0},
        {'<', 0}, {'&', 0}, {'|', 0}, {'^', 0}, {'~', 0},
        {'@', 0}, {'#', 0}, {'$', 0}, {'_', 0},
        {'\\', 0}
    },

    .states = { 0, 1, 2 },

    .start_state = 1,
    .current_state = 1,

    .accepting_states = { 2 },

    .matrix = {
        .states_rows = {// [Other Characters] [Operator]
            { .new_state = { 0, 0 } }, // [Ø state]
            { .new_state = { 0, 2 } }, // [start state]
            { .new_state = { 0, 0 } }  // [accepting state]
        },
        .width = 2,
        .height = 3,
    },

    .type = CAT_OPERATOR,
    .dont_look_anymore = false
};

AutomataDFA specials_automata = {
    .alphabet = {
        // Caracteres especiales válidos (1)
        {';', 1}, {',', 1}, {'(', 1}, {')', 1},
        {'{', 1}, {'}', 1}, {'[', 1}, {']', 1},

        // Otros caracteres (0)
        {'a', 0}, {'b', 0}, {'c', 0}, {'d', 0}, {'e', 0}, {'f', 0},
        {'g', 0}, {'h', 0}, {'i', 0}, {'j', 0}, {'k', 0}, {'l', 0},
        {'m', 0}, {'n', 0}, {'o', 0}, {'p', 0}, {'q', 0},
        {'r', 0}, {'s', 0}, {'t', 0}, {'u', 0}, {'v', 0}, {'w', 0},
        {'x', 0}, {'y', 0}, {'z', 0},

        {'A', 0}, {'B', 0}, {'C', 0}, {'D', 0}, {'E', 0}, {'F', 0},
        {'G', 0}, {'H', 0}, {'I', 0}, {'J', 0}, {'K', 0}, {'L', 0},
        {'M', 0}, {'N', 0}, {'O', 0}, {'P', 0}, {'Q', 0},
        {'R', 0}, {'S', 0}, {'T', 0}, {'U', 0}, {'V', 0}, {'W', 0},
        {'X', 0}, {'Y', 0}, {'Z', 0},

        {'0', 0}, {'1', 0}, {'2', 0}, {'3', 0}, {'4', 0},
        {'5', 0}, {'6', 0}, {'7', 0}, {'8', 0}, {'9', 0},

        {' ', 0}, {'\t', 0}, {'\n', 0}, {'\r', 0},
        {'.', 0}, {':', 0}, {'!', 0}, 
        {'?', 0}, {'"', 0}, {'\'', 0},
        {'`', 0}, {'+', 0}, {'-', 0}, {'*', 0},
        {'/', 0}, {'%', 0}, {'=', 0}, {'<', 0},
        {'>', 0}, {'&', 0}, {'|', 0}, {'^', 0},
        {'~', 0}, {'@', 0}, {'#', 0}, {'$', 0},
        {'_', 0}, {'\\', 0}
    },

    .states = { 0, 1, 2 },

    .start_state = 1,
    .current_state = 1,

    .accepting_states = { 2 },

    .matrix = {
        .states_rows = {// [Other Characters] [Special Char]
            { .new_state = { 0, 0 } }, // [Ø state]
            { .new_state = { 0, 2 } }, // [start state]
            { .new_state = { 0, 0 } }  // [accepting state]
        },
        .width = 2,
        .height = 3,
    },

    .type = CAT_SPECIALCHAR,
    .dont_look_anymore = false
};

AutomataDFA number_automata = {
    .alphabet = {
        // Dígitos (1)
        {'0', 1}, {'1', 1}, {'2', 1}, {'3', 1}, {'4', 1},
        {'5', 1}, {'6', 1}, {'7', 1}, {'8', 1}, {'9', 1},

        // Otros caracteres (0)
        {'a', 0}, {'b', 0}, {'c', 0}, {'d', 0}, {'e', 0}, {'f', 0},
        {'g', 0}, {'h', 0}, {'i', 0}, {'j', 0}, {'k', 0}, {'l', 0},
        {'m', 0}, {'n', 0}, {'o', 0}, {'p', 0}, {'q', 0},
        {'r', 0}, {'s', 0}, {'t', 0}, {'u', 0}, {'v', 0}, {'w', 0},
        {'x', 0}, {'y', 0}, {'z', 0},

        {'A', 0}, {'B', 0}, {'C', 0}, {'D', 0}, {'E', 0}, {'F', 0},
        {'G', 0}, {'H', 0}, {'I', 0}, {'J', 0}, {'K', 0}, {'L', 0},
        {'M', 0}, {'N', 0}, {'O', 0}, {'P', 0}, {'Q', 0},
        {'R', 0}, {'S', 0}, {'T', 0}, {'U', 0}, {'V', 0}, {'W', 0},
        {'X', 0}, {'Y', 0}, {'Z', 0},

        {' ', 0}, {'\t', 0}, {'\n', 0}, {'\r', 0},
        {'.', 0}, {',', 0}, {';', 0}, {':', 0},
        {'!', 0}, {'?', 0}, 
        {'"', 0}, {'\'', 0}, {'`', 0},
        {'(', 0}, {')', 0}, {'[', 0}, {']', 0}, {'{', 0}, {'}', 0},
        {'+', 0}, {'-', 0}, {'*', 0}, {'/', 0}, {'%', 0},
        {'=', 0}, {'<', 0}, {'>', 0},
        {'&', 0}, {'|', 0}, {'^', 0}, {'~', 0},
        {'@', 0}, {'#', 0}, {'$', 0}, {'_', 0},
        {'\\', 0}
    },

    .states = { 0, 1, 2 },

    .start_state = 1,
    .current_state = 1,

    .accepting_states = { 2 },

    .matrix = {
        .states_rows = {// [Other Characters] [Digit]
            { .new_state = { 0, 0 } }, // [Ø state]
            { .new_state = { 0, 2 } }, // [start state]
            { .new_state = { 0, 2 } }  // [accepting state]
        },
        .width = 2,
        .height = 3,
    },

    .type = CAT_NUMBER,
    .dont_look_anymore = false
};

AutomataDFA type_automata = {
    .alphabet = {
        // Categorías de letras para las palabras clave
        {'i', 1}, {'n', 2}, {'t', 3},
        {'c', 4}, {'h', 5}, {'a', 6}, {'r', 7},
        {'v', 8}, {'o', 9}, {'d', 10},
        // Todos los demás caracteres → 0
        {'b',0},{'e',0},{'f',0},{'g',0},{'j',0},{'k',0},{'l',0},{'m',0},{'p',0},{'q',0},
        {'s',0},{'u',0},{'w',0},{'x',0},{'y',0},{'z',0},
        {'A',0},{'B',0},{'C',0},{'D',0},{'E',0},{'F',0},{'G',0},{'H',0},{'I',0},{'J',0},
        {'K',0},{'L',0},{'M',0},{'N',0},{'O',0},{'P',0},{'Q',0},{'R',0},{'S',0},{'T',0},
        {'U',0},{'V',0},{'W',0},{'X',0},{'Y',0},{'Z',0},
        {'0',0},{'1',0},{'2',0},{'3',0},{'4',0},{'5',0},{'6',0},{'7',0},{'8',0},{'9',0},
        {' ',0},{'\t',0},{'\n',0},{'\r',0},{';',0},{',',0},{'(',0},{')',0},{'{',0},{'}',0},
        {'[',0},{']',0},{'+',0},{'-',0},{'*',0},{'/',0},{'=',0},{'<',0},{'>',0},{'&',0},
        {'|',0},{'^',0},{'~',0},{'@',0},{'#',0},{'$',0},{'_',0},{'\\',0}
    },

    .states = {0,1,2,3,4,5,6,7,8,9,10},

    .start_state = 1,
    .current_state = 1,

    .accepting_states = {10},

    .matrix = {
        .states_rows = {
            { .new_state = {0,0,0,0,0,0,0,0,0,0,0} },   //0
            { .new_state = {0,2,0,0,4,0,0,0,7,0,0} },   //1
            { .new_state = {0,0,3,0,0,0,0,0,0,0,0} },   //2
            { .new_state = {0,0,0,10,0,0,0,0,0,0,0} },   //3
            { .new_state = {0,0,0,0,0,5,0,0,0,0,0} },   //4
            { .new_state = {0,0,0,0,0,0,6,0,0,0,0} },   //5
            { .new_state = {0,0,0,0,0,0,0,10,0,0,0} },   //6
            { .new_state = {0,0,0,0,0,0,0,0,0,8,0} },   //7
            { .new_state = {0,9,0,0,0,0,0,0,0,0,0} },   //8
            { .new_state = {0,0,0,0,0,0,0,0,0,0,10} },   //9
            { .new_state = {0,0,0,0,0,0,0,0,0,0,0} }    //10
        },
        .width = 13,
        .height = 11
    },

    .type = CAT_TYPE,
    .dont_look_anymore = false
};

AutomataDFA keyword_automata = {
    .alphabet = {
        // Letras clave con categorías únicas
        {'i', 1}, {'f', 2}, {'o', 3}, {'r', 4},{'w', 5},  {'h', 6}, {'l', 7}, 
        {'e', 8}, {'s', 9},{'t', 10},{'u', 11},{'n', 12},

        // Todos los demás caracteres → 0
        {'a',0},{'b',0},{'c',0},{'d',0},{'g',0},{'j',0},{'k',0},{'m',0},{'p',0},{'q',0},
        {'v',0},{'x',0},{'y',0},{'z',0},
        {'A',0},{'B',0},{'C',0},{'D',0},{'E',0},{'F',0},{'G',0},{'H',0},{'I',0},{'J',0},{'K',0},{'L',0},
        {'M',0},{'N',0},{'O',0},{'P',0},{'Q',0},{'R',0},{'S',0},{'T',0},{'U',0},{'V',0},{'W',0},{'X',0},
        {'Y',0},{'Z',0},
        {'0',0},{'1',0},{'2',0},{'3',0},{'4',0},{'5',0},{'6',0},{'7',0},{'8',0},{'9',0},
        {' ',0},{'\t',0},{'\n',0},{'\r',0},{';',0},{',',0},{'(',0},{')',0},{'{',0},{'}',0},{'[',0},{']',0},
        {'+',0},{'-',0},{'*',0},{'/',0},{'=',0},{'<',0},{'>',0},{'&',0},{'|',0},{'^',0},{'~',0},{'@',0},
        {'#',0},{'$',0},{'_',0},{'\\',0}
    },

    .states = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17},

    .start_state = 1,
    .current_state = 1,

    .accepting_states = {17}, // Único estado de aceptación

    .matrix = {
        // Fila = categoria, columna = estado actual
        .states_rows = {
            { .new_state = {0,0,0,0,0,0,0,0,0,0,0,0,0} },   // 0 (Ø state)
            { .new_state = {0,2,3,0,12,5,0,0,9,0,0,0,0} },   // 1 (start state)
            { .new_state = {0,0,17,0,0,0,0,0,0,0,0,0,0} },   // 2
            { .new_state = {0,0,0,4,0,0,0,0,0,0,0,0,0} },   // 3
            { .new_state = {0,0,0,0,17,0,0,0,0,0,0,0,0} },   // 4
            { .new_state = {0,0,0,0,0,0,6,0,0,0,0,0,0} },   // 5
            { .new_state = {0,7,0,0,0,0,0,0,0,0,0,0,0} },   // 6
            { .new_state = {0,0,0,0,0,0,0,8,0,0,0,0,0} },   // 7
            { .new_state = {0,0,0,0,0,0,0,0,17,0,0,0,0} },   // 8
            { .new_state = {0,0,0,0,0,0,0,10,0,0,0,0,0} },   // 9
            { .new_state = {0,0,0,0,0,0,0,0,0,11,0,0,0} },   // 10
            { .new_state = {0,0,0,0,0,0,0,0,17,0,0,0,0} },   // 11
            { .new_state = {0,0,0,0,0,0,0,0,13,0,0,0,0} },   // 12
            { .new_state = {0,0,0,0,0,0,0,0,0,0,14,0,0} },   // 13
            { .new_state = {0,0,0,0,0,0,0,0,0,0,0,15,0} },   // 14
            { .new_state = {0,0,0,0,16,0,0,0,0,0,0,0,0} },   // 15
            { .new_state = {0,0,0,0,0,0,0,0,0,0,0,0,17} },   // 16
            { .new_state = {0,0,0,0,0,0,0,0,0,0,0,0,0} }    // 17 (accepting state)

        },
        .width = 13,
        .height = 18
    },

    .type = CAT_KEYWORD,
    .dont_look_anymore = false
};

AutomataDFA* ALL_AUTOMATA[] = {
    &literal_automata,
    &operator_automata,
    &specials_automata,
    &number_automata,
    &type_automata,
    &keyword_automata,
    &identifier_automata
};

int NUM_AUTOMATA = sizeof(ALL_AUTOMATA) / sizeof(ALL_AUTOMATA[0]);
